<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.537">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Econ4261 - Week 10 - The Child Penalty</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Econ4261</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Lectures.html"> 
<span class="menu-text">Lecture Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Recitations.html"> 
<span class="menu-text">Recitation Materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Data.html"> 
<span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-homework" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Homework</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-homework">    
        <li>
    <a class="dropdown-item" href="../assignments/GroupProject.html">
 <span class="dropdown-text">Group Project</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/Homework-1.html">
 <span class="dropdown-text">Homework 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/Homework-2.html">
 <span class="dropdown-text">Homework 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/Homework-3.html">
 <span class="dropdown-text">Homework 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/Homework-4.html">
 <span class="dropdown-text">Homework 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/Homework-5.html">
 <span class="dropdown-text">Homework 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../Exercises.html"> 
<span class="menu-text">Practice Exercises</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">1 - Intro</a></li>
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data">2 - Loading the Data</a></li>
  <li><a href="#estimating-specifications" id="toc-estimating-specifications" class="nav-link" data-scroll-target="#estimating-specifications">3 - Estimating Specifications</a></li>
  <li><a href="#transforming-the-estimates" id="toc-transforming-the-estimates" class="nav-link" data-scroll-target="#transforming-the-estimates">4 - Transforming the Estimates</a></li>
  <li><a href="#making-a-nice-graph" id="toc-making-a-nice-graph" class="nav-link" data-scroll-target="#making-a-nice-graph">5 - Making a nice graph</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 10 - The Child Penalty</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<section id="intro" class="level1">
<h1>1 - Intro</h1>
<p>Following our discussion in class, we are going to estimate the “child penalty”, i.e.&nbsp;the effect of child birth on employment and earnings using data from the NLSY79. A brief summary of the variables we want to use:</p>
<ul>
<li><code>id</code>: the id variable of the individual</li>
<li><code>earn_ly</code>: a dummy indicating if the individual is employed last year</li>
<li><code>earnings_ly</code>: reported earnings for the individual last year</li>
<li><code>female</code>: a factor variable equal to “Women” if female and “Men” if male</li>
<li><code>t_es_ly</code>: an index of “event study time” for variables measured last year. It measures the years since the birth of the first child.</li>
</ul>
<p>You can verify that <code>t_es_ly</code> is equal to the year that the variable is measured (<code>doiy</code>-1, the year of interview minus one) minus the year of birth for the first child (<code>ch1yob</code>).</p>
<p>Letting <span class="math inline">\(t\)</span> index time relative to the event, the event-study specification for outcome <span class="math inline">\(Y_{nt}\)</span> is:</p>
<p><span class="math display">\[ Y_{nt} = \mu_{a(n,t)} + \gamma_{y(n,t)} + \sum_{s=-5}^{10}\alpha_{s}\mathbf{1}\{s=t\} + \epsilon_{n,t} \]</span></p>
<p>where <span class="math inline">\(a(n,t)\)</span> is the age of the person at time <span class="math inline">\(t\)</span>, <span class="math inline">\(y(n,t)\)</span> is the calendar year, and <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\gamma\)</span> are vectors of age and year fixed effects.</p>
<p>In order to make a comparison of the child penalty across genders, we will estimate this model separately for men and women.</p>
<p>Notice that this model is not identified without also assuming an “excluded category”. We would like to use the year before birth of the first child as the relative year, which requires the normalization <span class="math inline">\(\alpha_{-1}=0\)</span>, and so each <span class="math inline">\(\alpha_{t}\)</span> measures the effect relative to the year before the event.</p>
</section>
<section id="loading-the-data" class="level1">
<h1>2 - Loading the Data</h1>
<p>The code below loads cleaned NLSY79 data that we will use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/nlsy79_clean_all.RData"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nlsy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id doiy female doby dobm                race        dob sex age    region
1  1 1979  Women 1958    9 White, non-hispanic 1958-09-15   2  20 Northeast
2  1 1981  Women 1958    9 White, non-hispanic 1958-09-15   2  22 Northeast
3  2 1984  Women 1959    1 White, non-hispanic 1959-01-15   2  25 Northeast
4  2 2006  Women 1959    1 White, non-hispanic 1959-01-15   2  47 Northeast
5  2 1989  Women 1959    1 White, non-hispanic 1959-01-15   2  30 Northeast
6  2 2000  Women 1959    1 White, non-hispanic 1959-01-15   2  41 Northeast
      wgt                   marst earnings_ly doim nchild ch1yob     ch1dob
1 5635.63    Never married/single        4620    3     NA     NA       &lt;NA&gt;
2 6153.26    Never married/single        5000    6     NA     NA       &lt;NA&gt;
3 7915.75    Never married/single       11500    1      2   1993 1993-03-15
4 9904.01 Married, spouse present        5500    4      2   1993 1993-03-15
5 8293.04    Never married/single       19000    6      2   1993 1993-03-15
6 9416.32 Married, spouse present           0    6      2   1993 1993-03-15
      ch2dob        doi emp_lw earn_ly college edlevel age1b black white
1       &lt;NA&gt; 1979-03-15      1       1      NA HS grad    NA     0 white
2       &lt;NA&gt; 1981-06-15      1       1      NA HS grad    NA     0 white
3 1994-11-15 1984-01-15      1       1       0 HS grad    34     0 white
4 1994-11-15 2006-04-15      1       1       0 HS grad    34     0 white
5 1994-11-15 1989-06-15      1       1       0 HS grad    34     0 white
6 1994-11-15 2000-06-15      0       0       0 HS grad    34     0 white
  censusregion      start t_es_lw t_es_ly post child dataset age_factor
1         S-NE       &lt;NA&gt;      NA      NA   NA     0  NLSY79         20
2         S-NE       &lt;NA&gt;      NA      NA   NA     0  NLSY79         22
3         S-NE 1992-09-15      -9     -10    0     1  NLSY79         25
4         S-NE 1992-09-15      13      12    0     1  NLSY79         47
5         S-NE 1992-09-15      -4      -5    0     1  NLSY79         30
6         S-NE 1992-09-15       7       6    0     1  NLSY79         41
  doiy_factor age_female doiy_female statefip statename below_college
1        1979   20.Women  1979.Women       NA      &lt;NA&gt;     nocollege
2        1981   22.Women  1981.Women       NA      &lt;NA&gt;     nocollege
3        1984   25.Women  1984.Women       NA      &lt;NA&gt;     nocollege
4        2006   47.Women  2006.Women       NA      &lt;NA&gt;     nocollege
5        1989   30.Women  1989.Women       NA      &lt;NA&gt;     nocollege
6        2000   41.Women  2000.Women       NA      &lt;NA&gt;     nocollege</code></pre>
</div>
</div>
</section>
<section id="estimating-specifications" class="level1">
<h1>3 - Estimating Specifications</h1>
<p>The code below estimates the model separately for men and women. To account for correlations in the error term within individuals, we cluster standard errors at the individual level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>mod_w <span class="ot">&lt;-</span> nlsy <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(female<span class="sc">==</span><span class="st">"Women"</span>,t_es_ly<span class="sc">&gt;=-</span><span class="dv">5</span>,t_es_ly<span class="sc">&lt;=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">feols</span>(earn_ly <span class="sc">~</span> <span class="fu">as.factor</span>(t_es_ly) <span class="sc">|</span> age <span class="sc">+</span> doiy,<span class="at">data =</span>.,<span class="at">cluster=</span><span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 2,669 observations removed because of NA values (LHS: 2,669).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mod_m <span class="ot">&lt;-</span> nlsy <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(female<span class="sc">==</span><span class="st">"Men"</span>,t_es_ly<span class="sc">&gt;=-</span><span class="dv">5</span>,t_es_ly<span class="sc">&lt;=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">feols</span>(earn_ly <span class="sc">~</span> <span class="fu">as.factor</span>(t_es_ly) <span class="sc">|</span> age <span class="sc">+</span> doiy,<span class="at">data =</span>.,<span class="at">cluster=</span><span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 2,175 observations removed because of NA values (LHS: 2,175).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: earn_ly
Observations: 46,414 
Fixed-effects: age: 44,  doiy: 28
Standard-errors: Clustered (id) 
                      Estimate Std. Error   t value   Pr(&gt;|t|)    
as.factor(t_es_ly)-4 -0.005984   0.007388 -0.809956 4.1801e-01    
as.factor(t_es_ly)-3 -0.008967   0.008321 -1.077620 2.8126e-01    
as.factor(t_es_ly)-2 -0.005288   0.008528 -0.620026 5.3527e-01    
as.factor(t_es_ly)-1 -0.003624   0.008779 -0.412780 6.7979e-01    
as.factor(t_es_ly)0  -0.002325   0.008966 -0.259297 7.9542e-01    
as.factor(t_es_ly)1  -0.020044   0.009252 -2.166343 3.0339e-02 *  
as.factor(t_es_ly)2  -0.026490   0.009644 -2.746756 6.0436e-03 ** 
as.factor(t_es_ly)3  -0.029023   0.009858 -2.944069 3.2564e-03 ** 
as.factor(t_es_ly)4  -0.029285   0.010179 -2.876952 4.0349e-03 ** 
as.factor(t_es_ly)5  -0.032290   0.010631 -3.037409 2.4004e-03 ** 
as.factor(t_es_ly)6  -0.043405   0.011016 -3.940109 8.2723e-05 ***
as.factor(t_es_ly)7  -0.056894   0.011521 -4.938409 8.1719e-07 ***
as.factor(t_es_ly)8  -0.057437   0.012046 -4.768208 1.9196e-06 ***
as.factor(t_es_ly)9  -0.074134   0.012822 -5.781792 7.9090e-09 ***
as.factor(t_es_ly)10 -0.071170   0.013052 -5.452849 5.2319e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.345528     Adj. R2: 0.018061
                 Within R2: 0.00301 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: earn_ly
Observations: 51,880 
Fixed-effects: age: 42,  doiy: 28
Standard-errors: Clustered (id) 
                      Estimate Std. Error   t value   Pr(&gt;|t|)    
as.factor(t_es_ly)-4 -0.015723   0.007732  -2.03347 4.2059e-02 *  
as.factor(t_es_ly)-3 -0.034894   0.007955  -4.38638 1.1769e-05 ***
as.factor(t_es_ly)-2 -0.051431   0.008355  -6.15596 8.0616e-10 ***
as.factor(t_es_ly)-1 -0.099261   0.008633 -11.49791  &lt; 2.2e-16 ***
as.factor(t_es_ly)0  -0.269988   0.009679 -27.89299  &lt; 2.2e-16 ***
as.factor(t_es_ly)1  -0.294037   0.009940 -29.58204  &lt; 2.2e-16 ***
as.factor(t_es_ly)2  -0.296112   0.010080 -29.37643  &lt; 2.2e-16 ***
as.factor(t_es_ly)3  -0.307745   0.010327 -29.80090  &lt; 2.2e-16 ***
as.factor(t_es_ly)4  -0.321176   0.010678 -30.07761  &lt; 2.2e-16 ***
as.factor(t_es_ly)5  -0.328509   0.011095 -29.60856  &lt; 2.2e-16 ***
as.factor(t_es_ly)6  -0.328718   0.011548 -28.46621  &lt; 2.2e-16 ***
as.factor(t_es_ly)7  -0.341448   0.012174 -28.04741  &lt; 2.2e-16 ***
as.factor(t_es_ly)8  -0.340175   0.012670 -26.84868  &lt; 2.2e-16 ***
as.factor(t_es_ly)9  -0.328665   0.013288 -24.73481  &lt; 2.2e-16 ***
as.factor(t_es_ly)10 -0.333998   0.013852 -24.11252  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.443109     Adj. R2: 0.067237
                 Within R2: 0.0579  </code></pre>
</div>
</div>
<p>If we look at the model summaries above, we notice a problem. By default, the function <em>feols</em> does not use <span class="math inline">\(t=-1\)</span> as the excluded category, but rather <span class="math inline">\(t=-5\)</span>. We can transform these estimates to our preferred normalization by applying: <span class="math display">\[\hat{\alpha}_{t} = \hat{\tilde{\alpha}}_{t} - \hat{\tilde{\alpha}}_{-1} \]</span> with <span class="math inline">\(\hat{\tilde{\alpha}}_{-5}=0\)</span>. More on this in the next section.</p>
</section>
<section id="transforming-the-estimates" class="level1">
<h1>4 - Transforming the Estimates</h1>
<p>Notice that the vector of coefficients <span class="math inline">\(\tilde{\alpha}\)</span> has 15 elements (with <span class="math inline">\(\tilde{\alpha}_{-5}\)</span> excluded), which we would like to translate into a 16 element vector using the translation above, which is linear. We can write this in vector notation as: <span class="math display">\[ \alpha = R\tilde{\alpha} \]</span> where <span class="math inline">\(R\)</span> is a <span class="math inline">\(16\times 15\)</span> matrix constructed as below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">16</span>,<span class="dv">15</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>R[<span class="dv">1</span>,<span class="dv">4</span>] <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">16</span>) {</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    R[i,i<span class="dv">-1</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    R[i,<span class="dv">4</span>] <span class="ot">=</span> R[i,<span class="dv">4</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
 [1,]    0    0    0   -1    0    0    0    0    0     0     0     0     0
 [2,]    1    0    0   -1    0    0    0    0    0     0     0     0     0
 [3,]    0    1    0   -1    0    0    0    0    0     0     0     0     0
 [4,]    0    0    1   -1    0    0    0    0    0     0     0     0     0
 [5,]    0    0    0    0    0    0    0    0    0     0     0     0     0
 [6,]    0    0    0   -1    1    0    0    0    0     0     0     0     0
 [7,]    0    0    0   -1    0    1    0    0    0     0     0     0     0
 [8,]    0    0    0   -1    0    0    1    0    0     0     0     0     0
 [9,]    0    0    0   -1    0    0    0    1    0     0     0     0     0
[10,]    0    0    0   -1    0    0    0    0    1     0     0     0     0
[11,]    0    0    0   -1    0    0    0    0    0     1     0     0     0
[12,]    0    0    0   -1    0    0    0    0    0     0     1     0     0
[13,]    0    0    0   -1    0    0    0    0    0     0     0     1     0
[14,]    0    0    0   -1    0    0    0    0    0     0     0     0     1
[15,]    0    0    0   -1    0    0    0    0    0     0     0     0     0
[16,]    0    0    0   -1    0    0    0    0    0     0     0     0     0
      [,14] [,15]
 [1,]     0     0
 [2,]     0     0
 [3,]     0     0
 [4,]     0     0
 [5,]     0     0
 [6,]     0     0
 [7,]     0     0
 [8,]     0     0
 [9,]     0     0
[10,]     0     0
[11,]     0     0
[12,]     0     0
[13,]     0     0
[14,]     0     0
[15,]     1     0
[16,]     0     1</code></pre>
</div>
</div>
<p>Now finally note that if <span class="math inline">\(V_{\tilde{\alpha}}\)</span> is the covariance matrix for <span class="math inline">\(\hat{\tilde{\alpha}}\)</span>, then we must have:</p>
<p><span class="math display">\[ V_{\alpha} = RV_{\tilde{\alpha}}R^{T}.\]</span></p>
<p>Putting this altogether, we can write a function that takes the model estimates, re-normalizes the coefficients, calculates new standard errors, and returns a dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>t_index <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">10</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>make_df <span class="ot">&lt;-</span> <span class="cf">function</span>(R,mod,group) {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the transformed coefficients</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    new_coefs <span class="ot">=</span> R<span class="sc">%*%</span>mod<span class="sc">$</span>coefficients</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the new standard errors</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">=</span>  R<span class="sc">%*%</span>mod<span class="sc">$</span>cov.unscaled<span class="sc">%*%</span><span class="fu">t</span>(R)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    se <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(v))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">est =</span> new_coefs,<span class="at">t =</span> t_index,<span class="at">se =</span> se,<span class="at">group =</span> group)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># using the function here:</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>women_est <span class="ot">&lt;-</span> <span class="fu">make_df</span>(R,mod_w,<span class="st">"Women"</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>men_est <span class="ot">&lt;-</span> <span class="fu">make_df</span>(R,mod_m,<span class="st">"Men"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="making-a-nice-graph" class="level1">
<h1>5 - Making a nice graph</h1>
<p>With our nice transformed estimates we can make a pretty event study graph like we have seen in class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>men_est <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(women_est) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>t,<span class="at">y=</span>est,<span class="at">ymin=</span>est<span class="fl">-1.96</span><span class="sc">*</span>se,<span class="at">ymax=</span>est<span class="fl">+1.96</span><span class="sc">*</span>se,<span class="at">color=</span>group,<span class="at">fill=</span>group)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="at">alpha=</span><span class="fl">0.4</span>,<span class="at">color=</span><span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">0.5</span>,<span class="at">color=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Week-8_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Can you extend this to estimate the child penalty for annual earnings instead of employment?</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>